# RDB和AOF的区别

[Redis持久化RDB和AOF优缺点是什么，怎么实现的](https://segmentfault.com/a/1190000013958342)

[RDB和AOF两种持久化的对比](https://www.cnblogs.com/jieliu726/p/9045942.html)

[Redis教程(十)：持久化详解](https://www.jb51.net/article/65264.htm)

>  redis默认使用RDB, 但当redis 重启时会优先使用AOF

> 骚操作, 关闭持久化, 数据只在服务器运行时存



## RDB

在指定的时间间隔内将内存中的数据集快照写入磁盘

实际操作过程是fork一个子进程, 先将数据集写入 **临时的二进制文件** , 写入成功后, 再替换之前的文件(dump.rdb), 



### 优点

* **对于备份来说非常完美**, 一旦系统出现灾难性故障可以非常容易的进行恢复

    > 以在最近的 24 小时内, 每小时备份一次 RDB 文件, 并且在每个月的每一天, 也备份一个 RDB 文件

* RDB文件转移方便(一个文件)

* 性能最大化。在开始持久化时, 它唯一需要做的只是fork出子进程(或者在主线程执行), 之后再由子进程完成这些持久化的工作, 这样就可以极大的避免服务进程执行IO操作

* 相比于AOF机制, 如果数据集很大, RDB的启动效率会更高

### 缺点

* 有可能会 **丢失数据**, 一旦在定时持久化之前出现宕机现象数据都将丢失
* 由于RDB是通过fork子进程来协助完成数据持久化工作的, 因此, 如果当数据集较大时, 可能会导致整个服务器停止服务几百毫秒, 甚至是1秒钟(那应该要很大才可以吧, 几十个并发的还是不要担心这个吧)





## AOF

以日志的形式, 记录redis的每一步操作(查询不会)到appendonly.aof 中

当 Redis 重启时, 将会读取 AOF 文件进行“重放”以恢复到 Redis 关闭前的最后时刻 



### 优点

* 比RDB更高的数据安全性, 最多丢失本次来不及AOF的数据
* 如果日志过大, Redis可以自动启用rewrite机制( 即Redis以append模式不断的将修改数据写入到老的磁盘文件中) 
* AOF文件是可读的

### 缺点

* AOF文件比RDB文件大
* AOF效率要慢于RDB





二者选择的标准，就是看系统是愿意牺牲一些性能，换取更高的缓存一致性（aof），还是愿意写操作频繁的时候，不启用备份来换取更高的性能，待手动运行save的时候，再做备份（rdb）。rdb这个就更有些 eventually consistent的意思了。不过

**生产环境其实更多都是二者结合使用的。(但真正的结合使用只有在4.0版本后才引入的, 每天定时RDB然后使用AOF算是勉强的结合使用吧)**

