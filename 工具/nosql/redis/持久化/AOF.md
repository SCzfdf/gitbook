# AOF



## 触发策略

### always

redis将命令写入到缓冲区中. 缓冲区每有一条命令就把他同步到AOF文件中(可能不用缓冲区?)

### everysec

redis将命令写入到缓冲区中. 每个一秒就把命令同步到AOF文件中

> 可能会丢失0~2秒的数据 忘记在哪看的2秒大概是缓冲区接受了命令还没冲刷到硬盘

### no

redis将命令写入到缓冲区中. 由系统决定什么时候同步到AOF文件中(好像最慢是30秒)



## AOF文件重写

随着时间推移AOF文件可能会有很多无用命令(save 后又删除, incr几次的key)

AOF重写可以清除掉无用的命令减少AOF文件的大小

重写的过程也是redis fork出一个子进程, 由子进程将此时redis的数据全量写入到AOF文件中(刚开始还以为是判断AOF文件= =)

**AOF重写功能是好, 但要注意如果redis的内存占用比率越大耗时就越慢(一定条件下会阻塞主线程). 应该放宽AOF重写和不必要的全量复制**

## 选择

always 会极大的增大硬盘IO, 而且普通机械硬盘每秒大概只有几百TPS, 就算是固态硬盘估计也就翻100倍? 而且固态硬盘选用always 策略会急剧减低固态硬盘寿命

使用everysec 策略redis 和不使用持久化时的性能相差无几(一个占用IO一个是cpu= =) 

no 不可控一般不使用



